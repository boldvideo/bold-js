# Bold Video JavaScript SDK

> TypeScript client for the Bold Video API. Fetch videos, playlists, settings. Stream AI responses. Track analytics.

## Installation

```bash
npm install @boldvideo/bold-js
```

## Quick Start

```typescript
import { createClient } from '@boldvideo/bold-js';

const bold = createClient('your-api-key');

// Content methods return { data: T }
const { data: videos } = await bold.videos.list();
const { data: video } = await bold.videos.get('video-id-or-slug');

// AI streaming (default)
const stream = await bold.ai.chat({ prompt: 'How do I price my SaaS?' });
for await (const event of stream) {
  switch (event.type) {
    case 'text_delta': process.stdout.write(event.delta); break;
    case 'sources': console.log('Found:', event.sources.length); break;
    case 'message_complete': console.log('Done:', event.conversationId); break;
    case 'error': console.error(event.message); break;
  }
}

// AI non-streaming
const response = await bold.ai.recommendations({
  topics: ['sales', 'negotiation'],
  stream: false
});
console.log(response.guidance);
```

## Client Configuration

```typescript
createClient(apiKey: string, options?: ClientOptions)

interface ClientOptions {
  baseURL?: string;                  // Default: 'https://app.boldvideo.io/api/v1/'
  debug?: boolean;                   // Log requests (default: false)
  headers?: Record<string, string>;  // Additional headers
}
```

## Content Methods

All content methods return `Promise<{ data: T }>`.

- `bold.settings(videoLimit?)` - Channel settings, menus, featured playlists
- `bold.videos.list()` - List latest videos (default limit: 12)
- `bold.videos.list(limit)` - List with numeric limit (backwards compatible)
- `bold.videos.list(options)` - List with full options (see ListVideosOptions)
- `bold.videos.get(id)` - Get video by ID or slug
- `bold.videos.search(query)` - Search videos
- `bold.playlists.list()` - List playlists
- `bold.playlists.get(id)` - Get playlist with videos

### ListVideosOptions

```typescript
// For /videos/latest endpoint (default)
{
  limit?: number;           // Max videos (default: 12)
  tag?: string;             // Filter by tag
  collectionId?: string;    // Filter to collection
  viewerId?: string;        // Include watch progress
}

// For /videos (index) endpoint - use when you need pagination
{
  page?: number;            // Page number
  tag?: string;
  collectionId?: string;
}
```

Note: If `page` is provided, SDK uses `/videos` (index); otherwise uses `/videos/latest`.

## Viewers API

Manage external users and track video progress. Returns `Promise<{ data: T }>` (consistent with other SDK methods).

### Viewer CRUD

- `bold.viewers.list()` - List all viewers
- `bold.viewers.get(id)` - Get viewer by UUID
- `bold.viewers.lookup({ externalId })` - Find viewer by external ID
- `bold.viewers.lookup({ email })` - Find viewer by email
- `bold.viewers.create({ name, email?, externalId?, traits? })` - Create viewer
- `bold.viewers.update(id, { name?, email?, externalId?, traits? })` - Update viewer (traits replaced, not merged)

### Progress Tracking

- `bold.viewers.listProgress(viewerId, { completed?, collectionId? }?)` - List progress records
- `bold.viewers.getProgress(viewerId, videoId)` - Get progress for specific video
- `bold.viewers.saveProgress(viewerId, videoId, { currentTime, duration })` - Upsert progress

```typescript
// Example: Course platform integration
const { data: viewer } = await bold.viewers.lookup({ externalId: 'user_123' });
await bold.viewers.saveProgress(viewer.id, 'video-id', { currentTime: 120, duration: 600 });
const { data: progress, meta } = await bold.viewers.listProgress(viewer.id, { collectionId: 'course-id' });
console.log(`Completed ${meta.completed} of ${meta.total} videos`);
```

## AI Methods

All AI methods return `AsyncIterable<AIEvent>` (streaming) or `Promise<AIResponse>` (non-streaming).
Default is streaming (`stream: true`).

- `bold.ai.chat(options: ChatOptions)` - Conversational Q&A (library-wide or video-scoped)
- `bold.ai.search(options: SearchOptions)` - Semantic search with AI summary
- `bold.ai.recommendations(options: RecommendationsOptions)` - Topic-based video recommendations
- `bold.ai.getConversation(id: string)` - Retrieve conversation history by ID

**Deprecated aliases** (still work):
- `bold.ai.ask()` -> use `chat()`
- `bold.ai.coach()` -> use `chat()`
- `bold.ai.recommend()` -> use `recommendations()`

## AI Streaming Events

```typescript
type AIEvent =
  | { type: "message_start"; conversationId?: string; videoId?: string }
  | { type: "sources"; sources: Segment[] }
  | { type: "text_delta"; delta: string }
  | { type: "recommendations"; recommendations: Recommendation[] }
  | { type: "message_complete";
      conversationId?: string;
      content: string;
      citations: Segment[];
      responseType: "answer" | "clarification";
      usage?: AIUsage;
      context?: AIContextMessage[];
      recommendations?: Recommendation[];
      guidance?: string }
  | { type: "error"; code: string; message: string; retryable: boolean }
```

## AI Options

### ChatOptions

```typescript
{
  prompt: string;              // Required
  stream?: boolean;            // Default: true
  videoId?: string;            // Scope to specific video
  currentTime?: number;        // Playback position (with videoId)
  conversationId?: string;     // Continue conversation
  collectionId?: string;       // Filter to collection
  tags?: string[];             // Filter by tags
}
```

### SearchOptions

```typescript
{
  prompt: string;              // Required
  stream?: boolean;            // Default: true
  limit?: number;              // Max results
  collectionId?: string;
  videoId?: string;            // Search within video
  tags?: string[];
  context?: AIContextMessage[];
}
```

### RecommendationsOptions

```typescript
{
  topics: string[];            // Required (max: 10)
  stream?: boolean;            // Default: true
  limit?: number;              // Max per topic (default: 5, max: 20)
  collectionId?: string;
  tags?: string[];
  includeGuidance?: boolean;   // Default: true
  context?: AIContextMessage[];
}
```

## Core Types

### Video

```typescript
{
  id: string;
  slug?: string;
  title: string;
  description: string | null;
  duration: number;
  publishedAt: string;
  playbackId: string;
  streamUrl: string;
  thumbnail: string;
  tags?: string[];
  metaData: { title: string; description: string; image: string | null };
  chapters?: string;
  attachments?: VideoAttachment[];
  transcript?: { text: string; json: any };
}
```

### Segment (for sources/citations)

```typescript
{
  id: string;
  videoId: string;
  title: string;
  text: string;              // Transcript excerpt
  timestamp: number;         // Start seconds
  timestampEnd: number;      // End seconds
  playbackId: string;
  speaker?: string;
  cited?: boolean;
}
```

### Recommendation

```typescript
{
  topic: string;
  videos: Array<{
    videoId: string;
    title: string;
    playbackId: string;
    relevance: number;
    reason: string;
  }>;
}
```

### Viewer

```typescript
{
  id: string;
  name: string;
  email?: string;
  externalId?: string;
  traits?: Record<string, unknown>;  // User-defined metadata (keys preserved as-is)
  insertedAt: string;
  updatedAt: string;
}
```

### ViewerProgress

```typescript
{
  id: string;
  viewerId: string;
  videoId: string;
  currentTime: number;     // Playback position in seconds
  duration: number;        // Video duration in seconds
  percentage: number;      // 0-100
  completed: boolean;
  completedAt?: string;
  insertedAt: string;
  updatedAt: string;
}
```

### Other types exported

`Playlist`, `Settings`, `Portal`, `MenuItem`, `AIResponse`, `AIUsage`, `AIContextMessage`, `Conversation`, `ConversationMessage`, `RecommendationsResponse`, `Viewer`, `ViewerProgress`, `ViewerLookupParams`, `ListProgressOptions`, `ListVideosOptions`, `ListVideosLatestOptions`, `ListVideosIndexOptions`

## Error Handling

### HTTP Errors

SDK throws on non-2xx responses:
- 401: Invalid API key
- 403: Forbidden (check permissions)
- 429: Rate limited (retry with backoff)
- 500: Server error (retry)

```typescript
try {
  const { data } = await bold.videos.list();
} catch (error) {
  if (error.response?.status === 401) {
    console.error('Invalid API key');
  }
}
```

### Streaming Errors

Handle error events in stream:

```typescript
for await (const event of stream) {
  if (event.type === 'error') {
    console.error(`[${event.code}] ${event.message}`);
    if (event.retryable) { /* retry logic */ }
  }
}
```

## Analytics (Browser Only)

These methods require browser globals (`window`, `document`, `navigator`).
Do not use in Node.js.

- `bold.trackEvent(video, event)` - Track video playback
  - `video`: `{ id, title, duration }`
  - `event`: DOM Event (`play`, `pause`, `timeupdate`, `loadedmetadata`)
  - Note: `timeupdate` throttled to 5 seconds

- `bold.trackPageView(title: string)` - Track page views

## Links

- [GitHub](https://github.com/boldvideo/bold-js)
- [npm](https://www.npmjs.com/package/@boldvideo/bold-js)
- [API Docs](https://docs.boldvideo.io/docs/api)
- [Types Source](https://github.com/boldvideo/bold-js/blob/main/src/lib/types.ts)
